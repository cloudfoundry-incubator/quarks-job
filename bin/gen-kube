#!/usr/bin/env bash

set -o errexit
set -o nounset
set -o pipefail

GO111MODULE=${GO111MODULE:-on} #Always on, so it works also inside GOPATH
GIT_ROOT=${GIT_ROOT:-$(git rev-parse --show-toplevel)}
GROUP_VERSIONS="quarksjob:v1alpha1"
QUARKS_UTILS=${QUARKS_UTILS:-$(cd "${GIT_ROOT}"; ls -d -1 ./vendor/code.cloudfoundry.org/quarks-utils 2>/dev/null)}

 # We need to be sure to be aligned to what go mod declares
go mod vendor

cd "$GIT_ROOT"

export GIT_ROOT
export GROUP_VERSIONS

# invoking with bash required for permissions: https://github.com/golang/go/issues/34965
bash $QUARKS_UTILS/bin/gen-kube
